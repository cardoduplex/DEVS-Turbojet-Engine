/*
 * CSE 593 - Fall 2016 - Applied Project
 * Author  : Lucio Ortiz and Robert Blazewicz
 * Version : DEVSJAVA 3.0
 * Date    : 2016-09-16
 */
package TurbojetEngineMod;

import java.awt.Dimension;
import java.awt.Point;
import java.util.Vector;

import TurbojetEngineMod.TurbojetEngine;
import experiment.model.ExperimentEngineBackPorch;
import experiment.model.ExperimentEngineDataRecorder;
import experiment.model.ExperimentEngineFrontPorch;
import experiment.toolkit.Settings;
import experiment.toolkit.SettingsSingleton;
import view.modeling.ViewableAtomic;
import view.modeling.ViewableDigraph;

/**
 * The Class ExperimentEngine.
 */
public class TurbojetEngineExperiment extends ViewableDigraph {

  /** The settings. */
  private final Settings settings = SettingsSingleton.getInstance();

  /** The front porch. */
  private ViewableAtomic frontPorch;

  /** The back porch. */
  private ViewableAtomic backPorch;

  /** The data recorder. */
  private ViewableAtomic dataRecorder;

  /** The models. */
  private final Vector<TurbojetEngine> models = new Vector<TurbojetEngine>();

  /**
   * Instantiates a new experiment engine.
   */
  public TurbojetEngineExperiment() {
    this("Experiment Engine");
  }

  /**
   * Instantiates a new experiment engine.
   *
   * @param name the name
   */
  public TurbojetEngineExperiment(String name) {
    super(name);
    defineLayout();
  }

  /**
   * Define layout.
   */
  private void defineLayout() {
    final int totalModels = settings.lookupInt("ExperimentModelCount");

    frontPorch = new ExperimentEngineFrontPorch("FrontPorch", totalModels);
    backPorch = new ExperimentEngineBackPorch("BackPorch");
    dataRecorder = new ExperimentEngineDataRecorder("DataRecorder");

    add(frontPorch);
    add(backPorch);
    add(dataRecorder);
    addCoupling(backPorch, "trigger", frontPorch, "trigger");

    char initialVersion = 'A';
    for (int i = 0; i < totalModels; i++, initialVersion++) {
      final TurbojetEngine model = new TurbojetEngine("TurbojetEngine", initialVersion);
      models.add(model);
    }

    for (ViewableDigraph model : models) {
      add(model);
      addCoupling(frontPorch, "xOut", model, "xIn");
      addCoupling(model, "xOut", backPorch, "xIn");
      addCoupling(model, "xOut", dataRecorder, "xIn");
    }
  }

  /* (non-Javadoc)
   * @see view.modeling.ViewableDigraph#layoutForSimViewOverride()
   */
  @Override
  public boolean layoutForSimViewOverride()
  {
    int maxModelWidth = 0;
    for (TurbojetEngine model : models)
      if (maxModelWidth < model.getWidth())
        maxModelWidth = model.getWidth();

    final int modelStartX = 20;
    final int modelStartY = 100;
    int pointX = 0;
    int pointY = 20;
    frontPorch.setPreferredLocation(new Point(pointX, pointY));
    pointX += maxModelWidth + 30;
    backPorch.setPreferredLocation(new Point(pointX, pointY));
    dataRecorder.setPreferredLocation(new Point(pointX, pointY + 80));
    pointX += 200;

    pointY = modelStartY;
    for (TurbojetEngine model : models) {
      model.setPreferredLocation(new Point(modelStartX, pointY));
      pointY += model.getHeight() + 20;
    }

    preferredSize = new Dimension(pointX, pointY);
    return true;
  }
}
