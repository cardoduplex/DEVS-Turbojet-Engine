/*
 * CSE 593 - Fall 2016 - Applied Project
 * Author  : Lucio Ortiz and Robert Blazewicz
 * Version : DEVSJAVA 3.0
 * Date    : 2016-09-16
 */
package turbojet.engine;

import org.apache.commons.io.FilenameUtils;

import turbojet.toolkit.Calibration;
import turbojet.toolkit.Log;
import turbojet.toolkit.Settings;
import turbojet.toolkit.SettingsSingleton;
import turbojet.toolkit.ValueSet;
import turbojet.toolkit.ValueSetInterface;

/**
 * The Class EngineProcessStage.
 */
public class EngineProcessStage implements ValueSetInterface {

  /** The name. */
  private String name;

  /** The log. */
  private Log log;

  /** The calibration list. */
  private final Calibration[] calibrationList;

  /** The condition setup. */
  private ConditionSetup conditionSetup;

  /** The diffuser. */
  private Diffuser diffuser;

  /**
   * Instantiates a new engine process stage.
   *
   * @param name the name
   */
  public EngineProcessStage(final String name) {
    this.name = name;
    log = new Log(name);

    final Settings settings = SettingsSingleton.getInstance();

    char initialVersion = 'A';
    calibrationList = new Calibration[settings.lookupInt("EngineModelCount")];
    for (int i = 0; i < calibrationList.length; i++) {
      final Calibration calibration = new Calibration(false);
      final String filename = FilenameUtils.getBaseName(calibration.getFilename()) + (initialVersion++) + '.' + FilenameUtils.getExtension(calibration.getFilename());
      calibration.load(filename);
      calibrationList[i] = calibration;
    }

    conditionSetup = new ConditionSetup();
    diffuser = new Diffuser();
  }

  /* (non-Javadoc)
   * @see turbojet.toolkit.ValueSetInterface#processValueSet(turbojet.toolkit.ValueSet)
   */
  @Override
  public void processValueSet(final ValueSet valueSet) {
    final Calibration calibration = calibrationList[valueSet.getVersionIndex()];

    log.out("Processing " + valueSet.getKey());
    switch (name) {
    case "Condition Setup":
      conditionSetup.process(valueSet, calibration);
      break;
    case "Diffuser or Inlet":
      diffuser.process(valueSet, calibration);
      break;
    case "Fan":
      break;
    case "Low-pressure compressor":
      break;
    case "High-pressure compressor":
      break;
    case "Burner":
      break;
    case "Coolant mixer 1":
      break;
    case "Coolant mixer 2":
      break;
    case "High-pressure turbine":
      break;
    case "Low-pressure turbine":
      break;
    case "Mixer":
      break;
    case "Afterburner":
      break;
    case "Exhaust nozzle":
      break;
    }
  }

}
