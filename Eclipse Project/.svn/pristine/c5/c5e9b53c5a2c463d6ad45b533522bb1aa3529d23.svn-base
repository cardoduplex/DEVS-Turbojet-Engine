/*
 * CSE 593 - Fall 2016 - Applied Project
 * Author  : Lucio Ortiz and Robert Blazewicz
 * Version : DEVSJAVA 3.0
 * Date    : 2016-10-03
 */
package TurbojetEngineMod.engine;

import experiment.toolkit.Calibration;
import experiment.toolkit.ValueSet;

/**
 * The Class Compressor.
 */
public class Compressor extends EngineBase {

  /** The fluid model. */
  private final String KeFLUID_Str_Model;

  /** The gamma. */
  private double gamma;

  /** The Cp. */
  private double Cp;

  /** The Tt 2. */
  private double Tt2;

  /** The Pt 2. */
  private double Pt2;

  /** The pi c. */
  private double pi_c;

  /** The mdot zero. */
  private double mdot_zero;

  /**
   * Instantiates a new compressor.
   */
  public Compressor(final String name) {
    super(name);
    KeFLUID_Str_Model = "undefined";
  }

  public void process(final ValueSet valueSet, final Calibration calibration) {
    calibration.update(this);
    valueSet.valuePop(this);

    // Output parameters
    double tao_c = 0;
    double w_c = 0;
    double Wdot_c = 0;
    double Pt3 = 0;
    double psi = 0;
    double Tt3 = 0;

    switch (KeFLUID_Str_Model) {
    case "Isentropic/Static (subsonic)":
      // Temp. Ratio @ station 3
      tao_c = Math.pow(pi_c,((gamma-1)/gamma));

      // Specific work, compressor
      w_c = Cp*(Tt2*(tao_c-1));  //[Btu/lbm]

      // Compressor Work
      // Wdot_c = mdot_zero*w_c;  //[Btu/s]

      // Compressor Work (in hp)
      Wdot_c = mdot_zero*w_c*3600*(1/2545.7);  //[hp]

      // Stagnation Pressure @ stage 3
      Pt3 = Pt2*pi_c;

      // Stagnation Pressure @ stage 3 (in psi)
      psi = Pt3/144;  //Pt3 in [psi]

      // Stagnation Temp. @ stage 3
      Tt3 = Tt2*tao_c;

      break;
    case "Isentropic/Static (supersonic)":
      break;
    case "Polytropic/Static (supersonic)":
      break;
    default:
      log.out("Undefined fluid model '" + KeFLUID_Str_Model + "'");
      break;
    }

    valueSet.addValue(name, "tao_c",  tao_c,  "", "Temp. Ratio @ station 3");
    valueSet.addValue(name, "w_c",    w_c,    "[Btu/lbm]", "Specific work, compressor");
    valueSet.addValue(name, "Wdot_c", Wdot_c, "[hp]", "Compressor Work");
    valueSet.addValue(name, "Pt3",    Pt3,    "", "Stagnation Pressure @ stage 3");
    valueSet.addValue(name, "psi",    psi,    "[psi]", "Stagnation Pressure @ stage 3 (in psi)");
    valueSet.addValue(name, "Tt3",    Tt3,    "", "Stagnation Temp. @ stage 3");
    valueSet.valuePush(this);
  }
}
