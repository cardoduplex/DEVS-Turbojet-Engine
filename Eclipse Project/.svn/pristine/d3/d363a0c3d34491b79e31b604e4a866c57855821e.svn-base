/*
 * CSE 593 - Fall 2016 - Applied Project
 * Author  : Lucio Ortiz and Robert Blazewicz
 * Version : DEVSJAVA 3.0
 * Date    : 2016-09-24
 */
package experiment.toolkit;

import java.util.HashMap;

import org.apache.commons.io.FilenameUtils;

/**
 * The Class ValueSetCache.
 */
public class ValueSetCache {

  /** The value set map. */
  private HashMap<String, ValueSet> valueSetMap = new HashMap<String, ValueSet>();

  /**
   * Instantiates a new value set cache.
   */
  public ValueSetCache() {
  }

  /**
   * Test.
   *
   * @param key the key
   * @return true, if successful
   */
  public boolean test(final String key) {
    return valueSetMap.containsKey(key);
  }

  /**
   * Peek.
   *
   * @param key the key
   * @return the value set
   */
  public ValueSet peek(final String key) {
    return valueSetMap.get(key);
  }

  /**
   * Creates a ValueSet.
   *
   * @param run the run
   * @param version the version
   * @return the value set
   */
  public ValueSet create(final int run, final char version) {
    final ValueSet valueSet = new ValueSet(run, version);
    final ValueSetLoad valueSetLoad = new ValueSetLoad();
    final String valueSetFilename = FilenameUtils.getBaseName(valueSetLoad.getFilename()) + version + '.' + FilenameUtils.getExtension(valueSetLoad.getFilename());
    valueSetLoad.load(valueSet, valueSetFilename);
    return valueSet;
  }

  /**
   * Put and increment pass.
   *
   * @param valueSet the value set
   */
  public void putAndIncrementPass(final ValueSet valueSet) {
    valueSet.incrementPass();
    valueSetMap.put(valueSet.getKey(), valueSet);
  }

  /**
   * Put and increment update.
   *
   * @param valueSet the value set
   */
  public void putAndIncrementUpdates(final ValueSet valueSet) {
    if (!valueSet.isRunTerminated())
      valueSet.incrementUpdate();
    valueSetMap.put(valueSet.getKey(), valueSet);
  }

  /**
   * Put.
   *
   * @param valueSet the value set
   * @param consumers the consumers
   */
  public void put(final ValueSet valueSet, final int consumers) {
    valueSet.setConsumers(consumers);
    valueSetMap.put(valueSet.getKey(), valueSet);
  }

  /**
   * Pop.
   *
   * @param key the key
   * @return the value set
   */
  public ValueSet pop(final String key) {
    final ValueSet valueSet = valueSetMap.get(key);
    if (valueSet.decrementAndTestConsumers()) {
      valueSetMap.remove(valueSet.getKey());
    }
    return valueSet;
  }
}
