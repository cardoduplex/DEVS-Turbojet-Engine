/*
 * CSE 593 - Fall 2016 - Applied Project
 * Author  : Lucio Ortiz and Robert Blazewicz
 * Version : DEVSJAVA 3.0
 * Date    : 2016-09-24
 */
package experiment.toolkit;

import java.util.HashMap;

/**
 * The Class ValueSetCache.
 */
public class ValueSetCache {

  /** The value set map. */
  private HashMap<String, ValueSet> valueSetMap = new HashMap<String, ValueSet>();

  /**
   * Instantiates a new value set cache.
   */
  public ValueSetCache() {
  }

  /**
   * Test.
   *
   * @param key the key
   * @return true, if successful
   */
  public boolean test(final String key) {
    return valueSetMap.containsKey(key);
  }

  /**
   * Peek.
   *
   * @param key the key
   * @return the value set
   */
  public ValueSet peek(final String key) {
    return valueSetMap.get(key);
  }

  /**
   * Creates the.
   *
   * @param experiment the experiment
   * @param version the version
   * @return the value set
   */
  public ValueSet create(final int experiment, final char version) {
    final ValueSet valueSet = new ValueSet(experiment, version);
    final ValueSetLoad valueSetLoad = new ValueSetLoad();
    valueSetLoad.load(valueSet);
    return valueSet;
  }

  public void putAndIncrementInstance(final ValueSet valueSet) {
    valueSet.incrementInstance();
    valueSetMap.put(valueSet.getKey(), valueSet);
    //String x="[put+inc] "+valueSet.getKey()+" to ";for(String y:valueSetMap.keySet()){x+=y+";";};System.out.println(x);
  }

  public void putAndIncrementMutation(final ValueSet valueSet) {
    valueSet.incrementMutation();
    valueSetMap.put(valueSet.getKey(), valueSet);
    //String x="[put+mut] "+valueSet.getKey()+" to ";for(String y:valueSetMap.keySet()){x+=y+";";};System.out.println(x);
  }

  public void putFinal(final ValueSet valueSet, final int consumers) {
    valueSet.setConsumers(consumers);
    String x="[putFinal] "+valueSet.getKey()+" to ";for(String y:valueSetMap.keySet()){x+=y+";";};System.out.println(x);
    valueSetMap.put(valueSet.getKey(), valueSet);
  }

  public ValueSet pop(final String key) {
    final ValueSet valueSet = valueSetMap.get(key);
    valueSetMap.remove(valueSet.getKey());
    //String x="[pop] "+valueSet.getKey()+" from ";for(String y:valueSetMap.keySet()){x+=y+";";};System.out.println(x);
    return valueSet;
  }

  public ValueSet popFinal(final String key) {
    final ValueSet valueSet = valueSetMap.get(key);
    if (valueSet.decrementAndTestConsumers()) {
      valueSetMap.remove(valueSet.getKey());
      System.out.println("remove "+valueSet.getKey());
    }
    String x="[popFinal] "+valueSet.getKey()+" from ";for(String y:valueSetMap.keySet()){x+=y+";";};System.out.println(x);
    return valueSet;
  }
}
